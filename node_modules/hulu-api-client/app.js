var hulu = require('./hulu.api'),
	express = require('express'),
	app = express();

app.configure(function() {
	app.set('port', (process.env.PORT || 8000));
	app.set('view engine', 'jade');
	app.use(express.compress());
	app.use(express.methodOverride());
	app.use(express.bodyParser());
	app.use(express.cookieParser('QmxhY2tPcHNBbGxlbk1hbGljaW91c1Nhcmtpc3lhbg=='));
	app.use(express.cookieSession());
});

app.configure('development', function() {
	app.enable('view cache');
	app.use(express.favicon());
	app.use(express.logger('dev'));
	app.use(express.errorHandler());
});

app.locals.pretty = true;

app.get('/', function (req, res) {
	hulu.getShows({
		limit: 100,
		order_by: 'name%20asc',
		total: 0
	}, function (response) {
		res.send(JSON.parse(response));
	});
});

app.get('/shows', function (req, res) {
	hulu.getShows({
		limit: 100,
		order_by: 'name%20asc',
		total: 0
	}, function (response) {
		res.send(JSON.parse(response));
	});
});

app.get('/videos', function (req, res) {
	hulu.getVideos({
		limit: 100,
		page: 5,
		order_by: 'name%20asc',
		total: 0
	}, function (response) {
		res.send(JSON.parse(response));
	});
});

app.get('/videos/:showId', function (req, res) {
	var showId = req.params.showId;

	hulu.getVideos({
		show_id: showId,
		limit: 100,
		order_by: 'name%20asc',
		total: 0
	}, function (response) {
		res.send(JSON.parse(response));
	});
});

app.get('/getVideo/:videoId', function (req, res) {
	var videoId = req.params.videoId;

	hulu.getVideos({
		video_id: videoId,
		limit: 100,
		order_by: 'name%20asc',
		total: 0
	}, function (response) {
		var data = JSON.parse(response);
		res.send(data);
	});
});

app.get('/watch/:videoId', function (req, res) {
	var videoId = req.params.videoId;

	hulu.getVideos({
		video_id: videoId,
		limit: 100,
		order_by: 'name%20asc',
		total: 0
	}, function (response) {
		var data = JSON.parse(response);
		var eid = data.video.eid;
		res.send(hulu.getEmbedCode(eid, 960, 540));
	});
});


app.get('/search/:query', function (req, res) {
	var query = req.params.query;

	hulu.search({
		query: query
	}, function (response) {
		var data = JSON.parse(response);
		res.send(data);
	});
});

app.listen(8000);